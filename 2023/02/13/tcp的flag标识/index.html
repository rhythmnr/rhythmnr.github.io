

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="NR">
  <meta name="keywords" content="">
  
    <meta name="description" content="所有标识位图片来自维基百科  TCP报文段分为首部和数据部分，TCP首部分为固定部分和选项(变长部分)，首部的固定部分(共有20字节);可选部分的长度为0~40字节 6个主要的标志位 URG和PSH在数据传输的过程中使用  紧急位URG 确认位ACKACK 携带两个信息。期待要收到下一个数据包的编号、接收方的接收窗口的剩余容量 推送位PSH(Push)。PSH 标志位表示发送端请求接收端尽快将数据">
<meta property="og:type" content="article">
<meta property="og:title" content="tcp的flag标识">
<meta property="og:url" content="https://rhythmnr.github.io/2023/02/13/tcp%E7%9A%84flag%E6%A0%87%E8%AF%86/index.html">
<meta property="og:site_name" content="written for my own">
<meta property="og:description" content="所有标识位图片来自维基百科  TCP报文段分为首部和数据部分，TCP首部分为固定部分和选项(变长部分)，首部的固定部分(共有20字节);可选部分的长度为0~40字节 6个主要的标志位 URG和PSH在数据传输的过程中使用  紧急位URG 确认位ACKACK 携带两个信息。期待要收到下一个数据包的编号、接收方的接收窗口的剩余容量 推送位PSH(Push)。PSH 标志位表示发送端请求接收端尽快将数据">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2023/02/09/pSWuNHs.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/02/09/pSRjFr4.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/02/09/pSRjXQO.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/02/13/pSoehKf.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/02/09/pSRv3lT.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/02/13/pSoVGsU.png">
<meta property="og:image" content="https://s1.ax1x.com/2023/02/14/pSoqqtH.png">
<meta property="article:published_time" content="2023-02-13T12:33:00.000Z">
<meta property="article:modified_time" content="2025-03-29T14:34:36.739Z">
<meta property="article:author" content="NR">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s1.ax1x.com/2023/02/09/pSWuNHs.png">
  
  
  <title>tcp的flag标识 - written for my own</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"rhythmnr.github.io","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.1.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>自己敲击的博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="tcp的flag标识"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-02-13 20:33" pubdate>
          2023年2月13日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.8k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          41 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">tcp的flag标识</h1>
            
            <div class="markdown-body">
              
              <h2 id="所有标识位"><a href="#所有标识位" class="headerlink" title="所有标识位"></a>所有标识位</h2><p>图片来自<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol">维基百科</a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pSWuNHs"><img src="https://s1.ax1x.com/2023/02/09/pSWuNHs.png" srcset="/img/loading.gif" lazyload alt="pSWuNHs.png"></a></p>
<p>TCP报文段分为首部和数据部分，TCP首部分为固定部分和选项(变长部分)，首部的固定部分(共有20字节);可选部分的长度为0~40字节</p>
<h3 id="6个主要的标志位"><a href="#6个主要的标志位" class="headerlink" title="6个主要的标志位"></a>6个主要的标志位</h3><blockquote>
<p>URG和PSH在数据传输的过程中使用</p>
</blockquote>
<p>紧急位URG</p>
<p>确认位ACKACK 携带两个信息。期待要收到下一个数据包的编号、接收方的接收窗口的剩余容量</p>
<p>推送位PSH(Push)。PSH 标志位表示发送端请求接收端尽快将数据传递给应用层。</p>
<p>复位位RST (Reset)：RST&#x3D; 1时，表明TCP连接中出现严重差错（如主机崩溃或其他原因)，必须释放连接，然后再重新建立运输连接。</p>
<p>同步位SYN：表示这是一个连接请求或连接接受报文。</p>
<p>终止位FIN：表明此报文段的发送方的数据已发送完毕，并要求释放传输连接。</p>
<p>###<strong>另外3个</strong></p>
<p>CWR：告诉对方本端已经减小了拥赛窗口</p>
<p>ECE：告诉对端对端的网络发生的拥赛</p>
<p>NS：无报文段</p>
<h2 id="常见的三次握手四次挥手"><a href="#常见的三次握手四次挥手" class="headerlink" title="常见的三次握手四次挥手"></a>常见的三次握手四次挥手</h2><h3 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h3><p><a target="_blank" rel="noopener" href="https://imgse.com/i/pSRjFr4"><img src="https://s1.ax1x.com/2023/02/09/pSRjFr4.png" srcset="/img/loading.gif" lazyload alt="pSRjFr4.png"></a></p>
<p>SYN&#x3D;1</p>
<p>SYN&#x3D;1 ACK&#x3D;1</p>
<p>ACK&#x3D;1</p>
<h3 id="四次挥手"><a href="#四次挥手" class="headerlink" title="四次挥手"></a>四次挥手</h3><p><a target="_blank" rel="noopener" href="https://imgse.com/i/pSRjXQO"><img src="https://s1.ax1x.com/2023/02/09/pSRjXQO.png" srcset="/img/loading.gif" lazyload alt="pSRjXQO.png"></a></p>
<p>FIN&#x3D;1</p>
<p>ACK&#x3D; 1</p>
<p>FIN&#x3D;1，ACK&#x3D; 1</p>
<p>ACK &#x3D; 1</p>
<p>这是wireshark里的抓到的三次握手四次挥手，可以观察具体场景中的Flag设置情况</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pSoehKf"><img src="https://s1.ax1x.com/2023/02/13/pSoehKf.png" srcset="/img/loading.gif" lazyload alt="pSoehKf.png"></a></p>
<p>我抓到的Flags有9位：</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pSRv3lT"><img src="https://s1.ax1x.com/2023/02/09/pSRv3lT.png" srcset="/img/loading.gif" lazyload alt="pSRv3lT.png"></a></p>
<h2 id="所有常见的flag组合"><a href="#所有常见的flag组合" class="headerlink" title="所有常见的flag组合"></a>所有常见的flag组合</h2><p>根据我电脑上抓包的结果，共18项</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-number">20</span><span class="hljs-symbol">:ACK+RST</span> 重置连接，并且确认了已经收到了对端的消息<br><span class="hljs-number">18</span><span class="hljs-symbol">:ACK+SYN</span> 确认连接建立<br><span class="hljs-number">25</span><span class="hljs-symbol">:ACK+PSH+FIN</span> 要求对端尽快将数据传递给应用层且关闭连接<br><span class="hljs-number">153</span><span class="hljs-symbol">:CWR+ACK+PSH+FIN</span> 正在结束连接，并且请求对端尽快将数据传递给应用层，通知对端本端已经减小了拥戴窗口<br><span class="hljs-number">144</span><span class="hljs-symbol">:CWR+ACK</span> 告诉对端本端已经减小了拥戴窗口<br><span class="hljs-number">194</span><span class="hljs-symbol">:CWR+ECE+SYN</span> 请求建立<span class="hljs-title class_">TCP</span>连接，告诉对端本端已经减小了拥戴窗口且对端网络拥塞了<br><span class="hljs-number">152</span><span class="hljs-symbol">:CWR+ACK+PSH</span> 收到了发送端传输的数据，并请求对端紧急发送数据，告诉对端本端已经减小了拥戴窗口<br><span class="hljs-number">24</span><span class="hljs-symbol">:ACK+PSH</span> 确认了已经收到了对端尽快将数据传递给应用层，如发送<span class="hljs-title class_">HTTP</span>请求和<span class="hljs-title class_">HTTP</span>响应中会出现<br><span class="hljs-number">16</span><span class="hljs-symbol">:ACK</span> 确认数据已成功接收<br><span class="hljs-number">17</span><span class="hljs-symbol">:ACK+FIN</span> 关闭连接<br><span class="hljs-number">2</span><span class="hljs-symbol">:SYN</span> 建立连接<br><span class="hljs-number">82</span><span class="hljs-symbol">:ECE+ACK+SYN</span> <span class="hljs-title class_">TCP</span>连接正在建立，通知对端其网络拥塞了<br><span class="hljs-number">4</span><span class="hljs-symbol">:RST</span> 重置连接<br><span class="hljs-number">148</span><span class="hljs-symbol">:CWR+ACK+RST</span> 强制重置连接且通知发送方网络拥塞的情况。通常在网络出现故障或拥塞时使用，用于快速终止连接。<br><span class="hljs-number">34</span><span class="hljs-symbol">:URG+SYN</span> 在连接建立时发送紧急数据<br><span class="hljs-number">210</span><span class="hljs-symbol">:CWR+ECE+ACK+SYN</span> <span class="hljs-title class_">TCP</span>的<span class="hljs-title class_">ECN</span> (显式拥塞通知)功能被启用，同时也表示<span class="hljs-title class_">TCP</span>连接正在建立。<br><span class="hljs-number">146</span><span class="hljs-symbol">:CWR+ACK+SYN</span> 发送方已经接收到对方的<span class="hljs-title class_">SYN</span>请求，并且表示接收到对方的拥塞窗口减少通知，同时也向对方发送一个确认应答。<br><span class="hljs-number">26</span><span class="hljs-symbol">:ACK+PSH+SYN</span> 发送方已经接收到对方的<span class="hljs-title class_">SYN</span>请求，同时需要立即推送数据，并向对方发送一个确认应答。<br></code></pre></td></tr></table></figure>

<p>没有URG的包，根据chatgpt的回答，增加了以下这些URG的情况：</p>
<blockquote>
<p>来自chatgpt</p>
<p>根据TCP协议的标准（RFC 793），所有合法的TCP标志组合如下：</p>
<ol>
<li>ACK：一般用于确认数据已成功接收。</li>
<li>SYN：用于建立连接。</li>
<li>SYN-ACK：连接请求后，服务端会返回SYN-ACK标志以确认连接建立。</li>
<li><strong>FIN：用于关闭连接。</strong>（这个上面的没有）</li>
<li>FIN-ACK：在关闭连接请求后，服务端会返回FIN-ACK标志以确认连接关闭。</li>
<li>RST：用于重置连接。</li>
<li>ACK-RST：表示重置请求已确认。</li>
<li><strong>PSH：用于将数据强制刷到接收端，以避免缓存。</strong></li>
<li><strong>URG：用于标识数据有紧急标志。</strong></li>
<li><strong>ECE：拥塞状态下的TCP的标志。</strong></li>
<li><strong>CWR：拥塞状态下的TCP的标志。</strong></li>
<li>NS：用于识别非恶意的报文。(我没有统计这个，忽略这个)</li>
</ol>
</blockquote>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-number">56</span><span class="hljs-symbol">:URG+PSH+ACK</span> 强制将紧急数据立即传递给应用层<br><span class="hljs-number">48</span><span class="hljs-symbol">:URG+ACK</span> 优先处理紧急数据<br></code></pre></td></tr></table></figure>

<p>总结下来就是如下这些TCP标志位（应该是大部分的，可能不是全部的）和对应的含义：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><span class="hljs-number">20</span>: <span class="hljs-title class_">ACK</span>、<span class="hljs-title class_">RST</span>被设置，表示重置连接，并且确认了已经收到了对端的消息<br><span class="hljs-number">18</span>: <span class="hljs-title class_">ACK</span>、<span class="hljs-title class_">SYN</span>被设置，表示确认连接建立<br><span class="hljs-number">25</span>: <span class="hljs-title class_">ACK</span>、<span class="hljs-title class_">PSH</span>、<span class="hljs-title class_">FIN</span>被设置，表示要求对端尽快将数据传递给应用层且关闭连接<br><span class="hljs-number">153</span>: <span class="hljs-title class_">CWR</span>、<span class="hljs-title class_">ACK</span>、<span class="hljs-title class_">PSH</span>、<span class="hljs-title class_">FIN</span>被设置，表示正在结束连接，并且请求对端尽快将数据传递给应用层，通知对端本端已经减小了拥戴窗口<br><span class="hljs-number">144</span>: <span class="hljs-title class_">CWR</span>、<span class="hljs-title class_">ACK</span>被设置，表示告诉对端本端已经减小了拥戴窗口<br><span class="hljs-number">194</span>: <span class="hljs-title class_">CWR</span>、<span class="hljs-title class_">ECE</span>、<span class="hljs-title class_">SYN</span>被设置，表示请求建立<span class="hljs-title class_">TCP</span>连接，告诉对端本端已经减小了拥戴窗口且对端网络拥塞了<br><span class="hljs-number">152</span> <span class="hljs-symbol">:CWR</span>、<span class="hljs-title class_">ACK</span>、<span class="hljs-title class_">PSH</span>被设置，表示收到了发送端传输的数据，并请求对端紧急发送数据，告诉对端本端已经减小了拥戴窗口<br><span class="hljs-number">24</span>: <span class="hljs-title class_">ACK</span>、<span class="hljs-title class_">PSH</span>被设置，表示确认了已经收到了对端尽快将数据传递给应用层，如发送<span class="hljs-title class_">HTTP</span>请求和<span class="hljs-title class_">HTTP</span>响应中会出现<br><span class="hljs-number">16</span>: <span class="hljs-title class_">ACK</span>被设置，表示确认数据已成功接收<br><span class="hljs-number">17</span>: <span class="hljs-title class_">ACK</span>、<span class="hljs-title class_">FIN</span>被设置，表示关闭连接<br><span class="hljs-number">2</span>: <span class="hljs-title class_">SYN</span>被设置，表示建立连接<br><span class="hljs-number">82</span>: <span class="hljs-title class_">ECE</span>、<span class="hljs-title class_">ACK</span>、<span class="hljs-title class_">SYN</span>被设置，表示<span class="hljs-title class_">TCP</span>连接正在建立，通知对端其网络拥塞了<br><span class="hljs-number">4</span>: <span class="hljs-title class_">RST</span>被设置，表示重置连接<br><span class="hljs-number">148</span><span class="hljs-symbol">:CWR+ACK+RST</span> 强制重置连接且通知发送方网络拥塞的情况。通常在网络出现故障或拥塞时使用，用于快速终止连接。<br><span class="hljs-number">34</span><span class="hljs-symbol">:URG+SYN</span> 在连接建立时发送紧急数据<br><span class="hljs-number">210</span><span class="hljs-symbol">:CWR+ECE+ACK+SYN</span> <span class="hljs-title class_">TCP</span>的<span class="hljs-title class_">ECN</span> (显式拥塞通知)功能被启用，同时也表示<span class="hljs-title class_">TCP</span>连接正在建立。<br><span class="hljs-number">146</span><span class="hljs-symbol">:CWR+ACK+SYN</span> 发送方已经接收到对方的<span class="hljs-title class_">SYN</span>请求，并且表示接收到对方的拥塞窗口减少通知，同时也向对方发送一个确认应答。<br><span class="hljs-number">26</span><span class="hljs-symbol">:ACK+PSH+SYN</span> 发送方已经接收到对方的<span class="hljs-title class_">SYN</span>请求，同时需要立即推送数据，并向对方发送一个确认应答。<br></code></pre></td></tr></table></figure>

<h2 id="不常见的标识"><a href="#不常见的标识" class="headerlink" title="不常见的标识"></a>不常见的标识</h2><h3 id="CWR和ECE"><a href="#CWR和ECE" class="headerlink" title="CWR和ECE"></a>CWR和ECE</h3><p>这2个在TCP拥塞控制中使用。</p>
<p>TCP拥塞控制通过计算窗口大小，动态调整发送速率来实现。在网络拥塞时，窗口大小会减小，减缓数据的发送速率；在网络空闲时，窗口大小会增加，加快数据的发送速率。通过这种方式，TCP拥塞控制能够在网络拥塞状态下有效地避免数据的丢失。</p>
<p><a target="_blank" rel="noopener" href="https://www.catchpoint.com/blog/ece-cwr-tcp">参考</a></p>
<p>这两个 TCP 标志与 IP 标头中的两个标志（ECT 和 CE）一起使用，以警告发送方网络拥塞，从而避免数据包丢失和重传。</p>
<p>Prior to acknowledging the receipt of the packet, the receiver sets the ECE flag in the TCP header of the ACK and sends it back to the sender. The sender having received the ECE marked ACK responds by halving the send window and reducing the slow start threshold.</p>
<p><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/working-of-explicit-congestion-notification/">参考</a>（这个讲得很好）这个讲了TCP拥塞控制的整个过程是什么样子的。</p>
<ol start="0">
<li><p>ECN协商</p>
</li>
<li><p>现在发件人正在向另一方发送数据包。 它将在 IP 标头中设置 ECT 以通知路由器发送方和接收方都启用了 ECN，并且他们已经相互通话。</p>
</li>
<li><p>路由器检测到了当前网络遇到了拥塞，当数据包到达路由器时，检测到数据包的IP头部有ECT，路由设置EC。CE 表明路由器正在经历拥塞。 CE 从路由器发送到接收方。这个过程中标头的变化是ECT [0 1] -&gt; CE [1 1]</p>
</li>
<li><p>接收方看到 IP 报头中的 CE 标记，就知道路由器拥塞了。 现在接收方有责任通知发送方拥塞。接收方标记TCP的ECE标头。</p>
<p>当 SYN&#x2F;ACK 位打开时，ECE 位表示 ECN 协商（也就是步骤0），而不是拥塞。 但是现在，ACK 数据包中的 ECE 位处于打开状态，因此发送方知道路由器拥塞。</p>
</li>
<li><p>发送方收到了ECE标志后，发送方将其拥塞窗口减少一半。</p>
</li>
<li><p>发送方在TCP头中设置CWR，在IP头中设置ECT，告诉接收方自己已经减小了拥塞窗口为了避免拥塞。</p>
</li>
<li><p>当数据包到达路由器时，如果路由器感到拥塞，它可以将 ECT 推销给 CE。</p>
</li>
<li><p>当数据包到达接收方时，因为这个数据包有CWR标识，接收方检测到这个标识后会停止在后续的 ACK 数据包中向发送方发送 ECE 标志。</p>
</li>
</ol>
<h3 id="PSH和URG"><a href="#PSH和URG" class="headerlink" title="PSH和URG"></a>PSH和URG</h3><p><a target="_blank" rel="noopener" href="https://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/">参考</a></p>
<p>初始 HTTP 请求设置了 PSH 标志，表明发送方没有进一步的数据要添加，接收方应立即发送到应用程序，不要把数据放到TCP缓冲区了。</p>
<p>URG用来告诉接收方有些数据是紧急的并且应该被优先处理。如果设置了 URG 标志，将评估紧急指针，这是 TCP 标头中的一个 16 位字段。 该指针指示数据包中有多少数据（从第一个字节开始计算）是紧急的。</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pSoVGsU"><img src="https://s1.ax1x.com/2023/02/13/pSoVGsU.png" srcset="/img/loading.gif" lazyload alt="pSoVGsU.png"></a></p>
<p>这个URG的情况很少出现。</p>
<h2 id="RFC文档"><a href="#RFC文档" class="headerlink" title="RFC文档"></a>RFC文档</h2><p>可以查看<a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/rfc793">rfc793文档</a>里的各个Figure，获取关于TCP连接状态变更和Flag变更的图。</p>
<h2 id="打印某个flag对应所有被设置的位"><a href="#打印某个flag对应所有被设置的位" class="headerlink" title="打印某个flag对应所有被设置的位"></a>打印某个flag对应所有被设置的位</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>	<span class="hljs-keyword">type</span> FlagName <span class="hljs-keyword">struct</span> &#123;<br>		Flag <span class="hljs-type">int</span><br>		Name <span class="hljs-type">string</span><br>	&#125;<br>	<span class="hljs-keyword">const</span> (<br>		FlagFIN = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-literal">iota</span><br>		FlagSYN<br>		FlagRST<br>		FlagPSH<br>		FlagACK<br>		FlagURG<br>		FlagECE<br>		FlagCWR<br>	)<br>	flagList := []FlagName&#123;<br>		&#123;FlagFIN, <span class="hljs-string">&quot;FIN&quot;</span>&#125;,<br>		&#123;FlagSYN, <span class="hljs-string">&quot;SYN&quot;</span>&#125;,<br>		&#123;FlagRST, <span class="hljs-string">&quot;RST&quot;</span>&#125;,<br>		&#123;FlagPSH, <span class="hljs-string">&quot;PSH&quot;</span>&#125;,<br>		&#123;FlagACK, <span class="hljs-string">&quot;ACK&quot;</span>&#125;,<br>		&#123;FlagURG, <span class="hljs-string">&quot;URG&quot;</span>&#125;,<br>		&#123;FlagECE, <span class="hljs-string">&quot;ECE&quot;</span>&#125;,<br>		&#123;FlagCWR, <span class="hljs-string">&quot;CWR&quot;</span>&#125;,<br>	&#125;<br>	all := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">0x014</span>, <span class="hljs-number">0x012</span>, <span class="hljs-number">0x019</span>, <span class="hljs-number">0x099</span>, <span class="hljs-number">0x090</span>, <span class="hljs-number">0x0c2</span>, <span class="hljs-number">0x098</span>, <span class="hljs-number">0x018</span>, <span class="hljs-number">0x010</span>, <span class="hljs-number">0x011</span>, <span class="hljs-number">0x002</span>, <span class="hljs-number">0x052</span>, <span class="hljs-number">0x004</span>&#125;<br>	<span class="hljs-comment">// all := []int&#123;20, 18, 25, 153, 144, 194, 152, 24, 16, 17, 2, 82, 4&#125;</span><br>	<span class="hljs-keyword">for</span> _, i := <span class="hljs-keyword">range</span> all &#123;<br>		fmt.Printf(<span class="hljs-string">&quot;%d:&quot;</span>, i)<br>		<span class="hljs-keyword">for</span> index := <span class="hljs-keyword">range</span> flagList &#123;<br>			last := <span class="hljs-built_in">len</span>(flagList) - <span class="hljs-number">1</span> - index<br>			current := flagList[last]<br>			<span class="hljs-keyword">if</span> current.Flag&amp;i != <span class="hljs-number">0</span> &#123;<br>				fmt.Print(current.Name + <span class="hljs-string">&quot; &quot;</span>)<br>			&#125;<br>		&#125;<br>		fmt.Println()<br>	&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">IntToByteArray</span><span class="hljs-params">(num <span class="hljs-type">int</span>)</span></span> []<span class="hljs-type">byte</span> &#123;<br>	size := <span class="hljs-type">int</span>(unsafe.Sizeof(num))<br>	arr := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, size)<br>	<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; size; i++ &#123;<br>		byt := *(*<span class="hljs-type">uint8</span>)(unsafe.Pointer(<span class="hljs-type">uintptr</span>(unsafe.Pointer(&amp;num)) + <span class="hljs-type">uintptr</span>(i)))<br>		arr[i] = byt<br>	&#125;<br>	<span class="hljs-keyword">return</span> arr<br>&#125;<br></code></pre></td></tr></table></figure>

<p>比如打印wireshark抓到的flags对应的0x010，就可以查看有哪些位被设置了。</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pSoqqtH"><img src="https://s1.ax1x.com/2023/02/14/pSoqqtH.png" srcset="/img/loading.gif" lazyload alt="pSoqqtH.png"></a></p>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" class="category-chain-item">计算机网络</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>tcp的flag标识</div>
      <div>https://rhythmnr.github.io/2023/02/13/tcp的flag标识/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>NR</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年2月13日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/02/17/go%E7%9A%84delve%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7/" title="go的delve调试工具">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">go的delve调试工具</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/02/07/geoip%E7%9A%84%E4%BD%BF%E7%94%A8/" title="geoip的使用">
                        <span class="hidden-mobile">geoip的使用</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    

  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>






  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
